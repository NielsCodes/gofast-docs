---
title: "Payments"
description: "Choose between Stripe, or Lemon Squeezy (not implemented)"
icon: "credit-card"
---

## Configuration

This choice can be made using the **GoFast CLI** or by modifying the `docker-compose.yml` file.

### via CLI

Possible options are `Stripe`, `Lemon Squeezy` and `Local (mock)`.

### via Docker Compose

Possible options are `stripe`, `lemon` and `local`.

### Payments Configuration

Depending on the provider, you need to set the following environment variables in the `docker-compose.yml` file:

- for `stripe`, set `STRIPE_API_KEY` and `STRIPE_PRICE_ID`.
- for `lemon`, set `LEMON_API_KEY` and `LEMON_PRICE_ID`.
- for `local`, no configuration is needed.

```yaml
services:
  server:
    environment:
      PAYMENT_PROVIDER: stripe
      STRIPE_API_KEY: ${STRIPE_API_KEY}
      STRIPE_PRICE_ID: ${STRIPE_PRICE_ID}
      # PAYMENT_PROVIDER: lemon
      # LEMON_API_KEY: ${LEMON_API_KEY}
      # LEMON_PRICE_ID: ${LEMON_PRICE_ID}
      # PAYMENT_PROVIDER: local
```

## Implementation Details

The payments implementation can generate the client **Checkout Session** to process payments, the **Customer Portal** to check invoices, and includes a **Webhook** implementation to listen for changes.
The flow is as follows:

1. The user clicks the subscribe button, sending a request to the backend.
2. The backend generates a Checkout URL.
3. The user completes the order.
4. A webhook on the backend listens for changes and updates the client's status accordingly.
5. After the client is created in the payment provider, they can visit their customer portal to check all invoices.

## Adding a New Provider

To add a new provider, follow these steps in the `/payment/provider.go` file:

1. Add the new provider to the `Provider` constant.

```go
const (
    stripe Provider = "stripe"
    lemon Provider = "lemon"
    local Provider = "local"
    poodle Provider = "poodle"
)
```

2. Create a new provider struct.

```go
type poodleProvider struct{}
```

3. Return the new provider in the `NewProvider` function:

```go
case Poodle:
    return &poodleProvider{}
```

4. Implement the required methods:

```go
func (p *poodleProvider) createCustomer(ctx context.Context, userEmail string) (customerId string, err error) {
    // Implement the logic to create a customer
}

func (p *poodleProvider) createPaymentCheckout(ctx context.Context, subscriptionId string) (url string, err error) {
    // Implement the logic to create a payment checkout
}

func (p *poodleProvider) createPaymentPortal(ctx context.Context, subscriptionId string) (url string, err error) {
    // Implement the logic to create a payment portal
}

func (p *poodleProvider) handleWebhook(ctx context.Context, payload []byte) (customerId string, subEndDate *time.Time, err error) {
    // Implement the logic to handle a webhook
}
```

5. Add any new secrets in the `env.go` file.

6. Fill in the `docker-compose.yml` file with the new provider configuration.

```yaml
services:
  server:
    environment:
      PAYMENT_PROVIDER: poodle
      POODLE_API_KEY: ${POODLE_API_KEY}
      POODLE_PRICE_ID: ${POODLE_PRICE_ID}
```

## Getting Secrets

### Stripe

In progress...

To test Stripe locally, don't forget to run a local test webhook command:

```bash
stripe listen --forward-to localhost:4002/payments/webhook
```

### Lemon Squeezy

In progress...

## Need help?

Visit our discord server to ask any questions, make suggestions and give feedback :).

https://discord.gg/EdSZbQbRyJ
